<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ç®¡ç†ç«¯</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      padding: 16px;
      margin: 0;
      background-color: #f8f9fa;
      color: #333;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
      background: white;
      border-radius: 8px;
      padding: 24px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    h1 {
      text-align: center;
      margin-bottom: 24px;
      color: #495057;
    }
    h2 {
      font-size: 1.2rem;
      margin-bottom: 12px;
      color: #6c757d;
    }
    input[type="file"] {
      width: 100%;
      padding: 8px;
      margin-bottom: 10px;
      border: 1px solid #ced4da;
      border-radius: 4px;
      box-sizing: border-box;
    }
    button {
      width: 100%;
      padding: 10px;
      margin-top: 10px;
      font-size: 1rem;
      background-color: #28a745;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    button:hover {
      opacity: 0.9;
    }
    .stats-container {
        margin-top: 30px;
        padding-top: 20px;
        border-top: 1px solid #dee2e6;
    }
    .stat-item {
        display: flex;
        justify-content: space-between;
        padding: 8px 0;
        border-bottom: 1px solid #eee;
    }
    .stat-label {
        font-weight: bold;
    }
    .stat-value {
        color: #495057;
    }
    #clearAllStatusBtn {
        background-color: #dc3545; /* Red */
    }
    #clearAllStatusBtn:hover {
        background-color: #c82333;
    }
    .loading {
        color: #888;
    }
    .message {
        margin-top: 10px;
        padding: 10px;
        border-radius: 4px;
        text-align: center;
    }
    .message.success {
        background-color: #d4edda;
        color: #155724;
    }
    .message.error {
        background-color: #f8d7da;
        color: #721c24;
    }
    /* æ–°å¢ï¼šè¯¦ç»†ç»Ÿè®¡æ ·å¼ */
    .detailed-stats-container {
        margin-top: 20px;
        padding: 15px;
        background-color: #f9f9f9;
        border-radius: 6px;
        border-left: 4px solid #007bff;
    }
    .detailed-stats-title {
        font-size: 1.1rem;
        font-weight: bold;
        margin-bottom: 10px;
        color: #495057;
    }
    .detailed-stat-item {
        margin-bottom: 8px;
    }
    .detailed-stat-type {
        font-weight: bold;
        color: #6c757d;
    }
    .detailed-stat-accounts {
        font-size: 0.9rem;
        color: #555;
        word-break: break-all; /* é˜²æ­¢é•¿è´¦å·å¯¼è‡´å¸ƒå±€é”™ä¹± */
    }
  </style>
  <style>
    /* æ·»åŠ è¡¨æ ¼æ ·å¼ */
    .detailed-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
      font-size: 0.9em;
    }
    .detailed-table, .detailed-table th, .detailed-table td {
      border: 1px solid #ccc;
    }
    .detailed-table th, .detailed-table td {
      padding: 4px;
      text-align: left;
    }
    .detailed-table th {
      background-color: #f2f2f2;
    }
    .detailed-stats-container {
      margin-top: 20px;
    }
    .detailed-stats-title {
      font-size: 1.2em;
      margin-bottom: 10px;
      font-weight: bold;
    }
    .detailed-stat-item {
      margin-bottom: 10px;
    }
    .message {
      padding: 10px;
      margin: 10px 0;
      border-radius: 4px;
    }
    .message.error {
      background-color: #ffebee;
      color: #c62828;
      border: 1px solid #ffcdd2;
    }
    .message.success {
      background-color: #e8f5e9;
      color: #2e7d32;
      border: 1px solid #c8e6c9;
    }
    .loading {
      color: #666;
      font-style: italic;
    }
    .stat-item {
      display: inline-block;
      margin-right: 20px;
      margin-bottom: 10px;
    }
    .stat-label {
      font-weight: bold;
    }
    .stat-value {
      font-size: 1.2em;
      color: #1976d2;
    }
    .container {
      max-width: 1200px; /* æˆ–æ ¹æ®éœ€è¦è°ƒæ•´ */
      margin: 0 auto;
      padding: 20px;
    }
    h1, h2, h3 {
      color: #333;
    }
    button {
      padding: 8px 16px;
      background-color: #1976d2;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    button:hover {
      background-color: #1565c0;
    }
    #clearAllStatusBtn {
      background-color: #d32f2f;
      margin-top: 10px;
    }
    #clearAllStatusBtn:hover {
      background-color: #b71c1c;
    }
    input[type="file"] {
      margin-right: 10px;
    }
  </style>


    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è®¾å¤‡ä¿¡æ¯ç®¡ç†ç³»ç»Ÿ - ç®¡ç†ç«¯</title>
    <style>
        /* ... (æ‚¨åŸæœ‰çš„æ ·å¼) ... */
        .message { /* æç¤ºä¿¡æ¯æ ·å¼ */
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
        }
        .message.success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .message.error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .dangerous-button { /* æ–°å¢ï¼šå±é™©æ“ä½œæŒ‰é’®æ ·å¼ */
            background-color: #dc3545; /* çº¢è‰² */
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin-top: 10px;
        }
        .dangerous-button:hover {
            background-color: #c82333; /* æ·±çº¢è‰² */
        }
        .stats-container {
            margin-bottom: 20px;
        }
        .detailed-stats-container {
            margin-top: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
    </style>
</head>
<body>
  <div class="container">
    <h1>è®¾å¤‡ä¿¡æ¯ç®¡ç†ç³»ç»Ÿ - ç®¡ç†ç«¯</h1>

    <div>
      <h2>å¯¼å…¥CSVæ•°æ®</h2>
      <input type="file" id="csvFile" accept=".csv" />
      <button onclick="importCSV()">ä¸Šä¼ CSV</button>
      <div id="importMessage"></div>
    </div>

    <div class="stats-container">
        <h2>ä»Šæ—¥ç»Ÿè®¡</h2>
        <div id="stats">
            <div class="loading">åŠ è½½ç»Ÿè®¡ä¿¡æ¯...</div>
        </div>
        <button id="clearAllStatusBtn" onclick="confirmClearAllStatus()">æ¸…é™¤æ‰€æœ‰çŠ¶æ€</button>
        <div id="clearMessage"></div>

    <div class="proxy-section" style="margin-top: 30px; padding: 20px; border: 1px solid #ddd; border-radius: 8px; background-color: #fafafa;">
        <h2>ä»£å®¢æ“ä½œåŒº</h2>
        <p style="color: #666; font-size: 0.9em;">ä¸ºæ— æ³•æ“ä½œçš„è®¾å¤‡ä»£ä¸ºæ ‡è®°çŠ¶æ€</p>

        <div style="display: flex; gap: 10px; margin-bottom: 15px;">
            <input type="text" id="proxyModelInput" placeholder="è¯·è¾“å…¥è®¾å¤‡ç¼–å·" style="flex: 1; padding: 8px; border: 1px solid #ccc; border-radius: 4px;" />
            <button onclick="proxyFetchDeviceInfo()" style="padding: 8px 16px; background-color: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;">æŸ¥è¯¢è®¾å¤‡</button>
        </div>
        <div id="proxyResult"></div>
    </div>

    <script>
    // ... (å…¶ä»–ç°æœ‰å‡½æ•°) ...

    async function proxyFetchDeviceInfo() {
      const input = document.getElementById('proxyModelInput');
      const modelId = input.value.trim();
      if (!modelId) {
        alert('è¯·è¾“å…¥è®¾å¤‡ç¼–å·');
        return;
      }
      const resultEl = document.getElementById('proxyResult');
      resultEl.innerHTML = '<p class="loading">æ­£åœ¨æŸ¥è¯¢...</p>';
      try {
        const response = await fetch('http://47.122.79.126:5233/api/device', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ model_id: modelId })
        });
        const data = await response.json();
        if (response.ok) {
          renderProxyResults(data, modelId);
        } else {
          resultEl.innerHTML = `<p style="color:red;">âŒ é”™è¯¯: ${data.error || 'æœªçŸ¥é”™è¯¯'}</p>`;
        }
      } catch (err) {
        resultEl.innerHTML = `<p style="color:red;">ğŸŒ ç½‘ç»œé”™è¯¯: ${err.message}</p>`;
      }
    }

    function renderProxyResults(data, modelId) {
      const resultEl = document.getElementById('proxyResult');
      if (!Array.isArray(data) || data.length === 0) {
        resultEl.innerHTML = '<p>è¯¥è®¾å¤‡ç¼–å·ä¸‹æœªæ‰¾åˆ°ç›¸å…³è´¦å·ä¿¡æ¯ã€‚</p>';
        return;
      }

      let html = `<h3>è®¾å¤‡ç¼–å· <strong>${modelId}</strong> çš„è´¦å·åˆ—è¡¨</h3>`;
      data.forEach((item) => {
        const recordId = item.id;
        const school = (item.å½•å…¥ç¼–å· ? `${item.å½•å…¥ç¼–å·}ã€` : '') + (item.å­¦æ ¡ || 'æœªçŸ¥å­¦æ ¡');
        const account = item.è´¦å· || '';
        const status = item.status || 'æœªå®Œæˆ';
        const statusColorClass = item.status_color || 'status-uncompleted';

        html += `
        <div class="proxy-result-item" style="border: 1px solid #ddd; border-radius: 4px; padding: 10px; margin-bottom: 10px;">
          <div><strong>${school}</strong></div>
          <div>è´¦å·: ${account}</div>
          <div class="status-display ${statusColorClass}" style="display:inline-block; padding: 2px 6px; margin: 5px 0; border-radius: 3px; font-size: 0.9em;">çŠ¶æ€: ${status}</div>

          <div style="margin-top: 8px;">
            <label for="statusSelect_${recordId}">æ ‡è®°ä¸º: </label>
            <select id="statusSelect_${recordId}" style="padding: 4px; margin-right: 10px;">
              <option value="ä»Šæ—¥å·²ç»å®Œæˆ">ä»Šæ—¥å·²ç»å®Œæˆ</option>
              <option value="å¯†ç é”™è¯¯">å¯†ç é”™è¯¯</option>
              <option value="è´¦å·ä¸å­˜åœ¨">è´¦å·ä¸å­˜åœ¨</option>
              <option value="ç½‘ç»œå¼‚å¸¸">ç½‘ç»œå¼‚å¸¸</option>
              <option value="è®¾å¤‡æ•…éšœ">è®¾å¤‡æ•…éšœ</option>
              <option value="æ‰‹æœºæ²¡ç”µ">æ‰‹æœºæ²¡ç”µ</option>
              <option value="éƒ¨ç½²å¼‚å¸¸">éƒ¨ç½²å¼‚å¸¸</option>
              <option value="NPSè”ç»“å¼‚å¸¸">NPSè”ç»“å¼‚å¸¸</option>
              <option value="è´¦å·è¢«å…¶ä»–äººç™»å½•">è´¦å·è¢«å…¶ä»–äººç™»å½•</option>
              <option value="æ—¶é—´ä¸å¤Ÿ">æ—¶é—´ä¸å¤Ÿ</option>
            </select>
            <button onclick="proxyMarkStatus(${recordId})" style="padding: 4px 8px; background-color: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer;">æ ‡è®°</button>
          </div>
        </div>`;
      });
      resultEl.innerHTML = html;
    }

    async function proxyMarkStatus(recordId) {
        const selectElement = document.getElementById(`statusSelect_${recordId}`);
        if (!selectElement) {
            console.error(`Status select element for record ${recordId} not found.`);
            return;
        }
        const newStatus = selectElement.value;

        try {
            const response = await fetch('http://47.122.79.126:5233/api/mark_status', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ record_id: recordId, status: newStatus })
            });
            const data = await response.json();
            if (response.ok) {
                alert(`è´¦å· ${recordId} çŠ¶æ€å·²æ›´æ–°ä¸º: ${newStatus}`);
                // é‡æ–°æŸ¥è¯¢å½“å‰è®¾å¤‡ä»¥åˆ·æ–°æ˜¾ç¤º
                const modelId = document.getElementById('proxyModelInput').value.trim();
                if (modelId) {
                    proxyFetchDeviceInfo();
                }
            } else {
                alert(`æ ‡è®°å¤±è´¥: ${data.error}`);
            }
        } catch (err) {
            console.error('Network error marking status via proxy:', err);
            alert("ç½‘ç»œé”™è¯¯ï¼Œæ ‡è®°å¤±è´¥ã€‚");
        }
    }

    // ... (å…¶ä½™ç°æœ‰ä»£ç ) ...
    </script>

    <style>
    /* ... (æ‚¨ç°æœ‰çš„CSS) ... */
    .proxy-result-item {
      border: 1px solid #ddd;
      border-radius: 4px;
      padding: 10px;
      margin-bottom: 10px;
    }
    .status-display {
      display: inline-block;
      padding: 2px 6px;
      margin: 5px 0;
      border-radius: 3px;
      font-size: 0.9em;
    }
    .status-display.status-completed { background-color: #d4edda; color: #155724; }
    .status-display.status-error { background-color: #f8d7da; color: #721c24; }
    .status-display.status-warning { background-color: #fff3cd; color: #856404; }
    .status-display.status-uncompleted { background-color: #d1ecf1; color: #0c5460; }
    </style>

        <!-- ä¿®æ”¹ï¼šè¯¦ç»†ç»Ÿè®¡å±•ç¤ºåŒºåŸŸ -->
        <div id="detailedStatsSection" class="detailed-stats-container" style="display:none;">
            <div class="detailed-stats-title">è¯¦ç»†å¼‚å¸¸ç»Ÿè®¡</div>
            <div id="detailedStatsContent"></div>
        </div>

        <!-- æ–°å¢ï¼šåˆ é™¤æ‰€æœ‰è®°å½•æŒ‰é’®åŒºåŸŸ -->
        <div class="dangerous-operation-section" style="margin-top: 20px; padding: 15px; border: 1px solid #ffc6cb; border-radius: 4px; background-color: #fff5f7;">
            <h3 style="color: #721c24;">å±é™©æ“ä½œåŒºåŸŸ</h3>
            <button id="deleteAllRecordsBtn" class="dangerous-button" onclick="confirmDeleteAllRecords()">åˆ é™¤æ‰€æœ‰è®°å½•</button>
            <div id="deleteMessage"></div>
        </div>

    </div>

  </div>

  <script>
    async function importCSV() {
        const fileInput = document.getElementById('csvFile');
        const messageDiv = document.getElementById('importMessage');

        if (!fileInput.files.length) {
            messageDiv.innerHTML = '<div class="message error">è¯·é€‰æ‹©ä¸€ä¸ªCSVæ–‡ä»¶</div>';
            return;
        }

        const formData = new FormData();
        formData.append('file', fileInput.files[0]);

        try {
            const response = await fetch('http://47.122.79.126:5233/api/import_csv', {
                method: 'POST',
                body: formData, // æ³¨æ„ï¼šä½¿ç”¨FormDataæ—¶ï¼Œä¸è¦è®¾ç½®Content-Typeï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨è®¾ç½®
            });

            const data = await response.json();
            if (response.ok) {
                messageDiv.innerHTML = `<div class="message success">${data.message}</div>`;
                loadStats(); // å¯¼å…¥æˆåŠŸååˆ·æ–°ç»Ÿè®¡
                loadDetailedStats(); // åŒæ—¶åˆ·æ–°è¯¦ç»†ç»Ÿè®¡
            } else {
                messageDiv.innerHTML = `<div class="message error">${data.error}</div>`;
            }
        } catch (err) {
            console.error('Import error:', err);
            messageDiv.innerHTML = '<div class="message error">ç½‘ç»œé”™è¯¯ï¼Œå¯¼å…¥å¤±è´¥</div>';
        }
    }

    async function loadStats() {
        try {
            const response = await fetch('http://47.122.79.126:5233/api/stats');
            const data = await response.json();
            if (response.ok) {
                const statsHtml = `
                    <div class="stat-item">
                        <span class="stat-label">ä»Šæ—¥å¼‚å¸¸:</span>
                        <span class="stat-value">${data.today_error_count}</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">ä»Šæ—¥æœªå®Œæˆ:</span>
                        <span class="stat-value">${data.today_uncompleted_count}</span>
                    </div>
                `;
                document.getElementById('stats').innerHTML = statsHtml;
            } else {
                document.getElementById('stats').innerHTML = `<div class="message error">åŠ è½½ç»Ÿè®¡å¤±è´¥: ${data.error}</div>`;
            }
        } catch (err) {
            console.error('Load stats error:', err);
            document.getElementById('stats').innerHTML = '<div class="message error">ç½‘ç»œé”™è¯¯ï¼ŒåŠ è½½ç»Ÿè®¡å¤±è´¥</div>';
        }
    }

    // --- ä¿®æ”¹å‡½æ•°ï¼šåŠ è½½è¯¦ç»†ç»Ÿè®¡ ---
    async function loadDetailedStats() {
        try {
            const response = await fetch('http://47.122.79.126:5233/api/detailed_stats');
            const data = await response.json();
            if (response.ok) {
                const detailedContentDiv = document.getElementById('detailedStatsContent');
                let detailedHtml = `<div class="detailed-stat-item"><strong>æ€»è®¡å¼‚å¸¸: ${data.total_error_count}</strong></div>`;

                // --- ä¿®æ”¹ï¼šç”Ÿæˆå¼‚å¸¸æ•°æ®è¡¨æ ¼ ---
                if (data.error_records && data.error_records.length > 0) {
                    detailedHtml += '<h3>å¼‚å¸¸è¯¦æƒ…</h3><table class="detailed-table"><thead><tr><th>å½•å…¥ç¼–å·</th><th>è®¾å¤‡ç¼–å·</th><th>è´¦å·</th><th>å¯†ç </th><th>å­¦æ ¡</th><th>å¼‚å¸¸ç±»å‹</th></tr></thead><tbody>';
                    data.error_records.forEach(record => {
                        detailedHtml += `<tr><td>${record.å½•å…¥ç¼–å· || ''}</td><td>${record.è®¾å¤‡ç¼–å· || ''}</td><td>${record.è´¦å· || ''}</td><td>${record.å¯†ç  || ''}</td><td>${record.å­¦æ ¡ || ''}</td><td>${record.status || ''}</td></tr>`;
                    });
                    detailedHtml += '</tbody></table>';
                } else {
                    detailedHtml += '<p>æ— å¼‚å¸¸æ•°æ®</p>';
                }

                // --- ä¿®æ”¹ï¼šç”Ÿæˆæœªå®Œæˆæ•°æ®è¡¨æ ¼ ---
                if (data.uncompleted_records && data.uncompleted_records.length > 0) {
                    detailedHtml += '<h3>æœªå®Œæˆè¯¦æƒ…</h3><table class="detailed-table"><thead><tr><th>å½•å…¥ç¼–å·</th><th>è®¾å¤‡ç¼–å·</th><th>è´¦å·</th><th>å¯†ç </th><th>å­¦æ ¡</th></tr></thead><tbody>';
                    data.uncompleted_records.forEach(record => {
                        detailedHtml += `<tr><td>${record.å½•å…¥ç¼–å· || ''}</td><td>${record.è®¾å¤‡ç¼–å· || ''}</td><td>${record.è´¦å· || ''}</td><td>${record.å¯†ç  || ''}</td><td>${record.å­¦æ ¡ || ''}</td></tr>`;
                    });
                    detailedHtml += '</tbody></table>';
                } else {
                    detailedHtml += '<p>æ— æœªå®Œæˆæ•°æ®</p>';
                }

                detailedContentDiv.innerHTML = detailedHtml;
                document.getElementById('detailedStatsSection').style.display = 'block'; // æ˜¾ç¤ºåŒºåŸŸ
            } else {
                document.getElementById('detailedStatsContent').innerHTML = `<div class="message error">åŠ è½½è¯¦ç»†ç»Ÿè®¡å¤±è´¥: ${data.error}</div>`;
                document.getElementById('detailedStatsSection').style.display = 'block'; // ç¡®ä¿åŒºåŸŸæ˜¾ç¤º
            }
        } catch (err) {
            console.error('Load detailed stats error:', err);
            document.getElementById('detailedStatsContent').innerHTML = '<div class="message error">ç½‘ç»œé”™è¯¯ï¼ŒåŠ è½½è¯¦ç»†ç»Ÿè®¡å¤±è´¥</div>';
            document.getElementById('detailedStatsSection').style.display = 'block'; // ç¡®ä¿åŒºåŸŸæ˜¾ç¤º
        }
    }


    function confirmClearAllStatus() {
        const confirmation = prompt("âš ï¸ å±é™©æ“ä½œï¼\næ­¤æ“ä½œå°†æ¸…é™¤æ‰€æœ‰è®°å½•çš„çŠ¶æ€ã€‚\nè¯·è¾“å…¥ 'ç¡®è®¤æ¸…é™¤' ä»¥ç»§ç»­ï¼š");
        if (confirmation === "ç¡®è®¤æ¸…é™¤") {
            sendClearAllStatusRequest();
        } else {
            document.getElementById('clearMessage').innerHTML = '<div class="message error">æ“ä½œå·²å–æ¶ˆ</div>';
        }
    }

    async function sendClearAllStatusRequest() {
        const messageDiv = document.getElementById('clearMessage');
        try {
            const response = await fetch('http://47.122.79.126:5233/api/clear_status', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ confirmation: "ç¡®è®¤æ¸…é™¤" })
            });

            const data = await response.json();
            if (response.ok) {
                messageDiv.innerHTML = `<div class="message success">${data.message}</div>`;
                loadStats(); // æ¸…é™¤æˆåŠŸååˆ·æ–°ç»Ÿè®¡
                loadDetailedStats(); // åŒæ—¶åˆ·æ–°è¯¦ç»†ç»Ÿè®¡
            } else {
                messageDiv.innerHTML = `<div class="message error">${data.error}</div>`;
            }
        } catch (err) {
            console.error('Clear status error:', err);
            messageDiv.innerHTML = '<div class="message error">ç½‘ç»œé”™è¯¯ï¼Œæ¸…é™¤å¤±è´¥</div>';
        }
    }

    // --- æ–°å¢å‡½æ•°ï¼šç¡®è®¤åˆ é™¤æ‰€æœ‰è®°å½• ---
    function confirmDeleteAllRecords() {
        const confirmation = prompt("âš ï¸ è¶…çº§å±é™©æ“ä½œï¼\næ­¤æ“ä½œå°†æ°¸ä¹…åˆ é™¤æ•°æ®åº“ä¸­çš„æ‰€æœ‰è®°å½•ï¼Œæ— æ³•æ¢å¤ï¼\nè¯·è¾“å…¥ 'æˆ‘çŸ¥é“æˆ‘åœ¨å¹²ä»€ä¹ˆæˆ‘æ­£åœ¨åˆ é™¤å…¨éƒ¨æ•°æ®' ä»¥ç»§ç»­ï¼š");
        if (confirmation === "æˆ‘çŸ¥é“æˆ‘åœ¨å¹²ä»€ä¹ˆæˆ‘æ­£åœ¨åˆ é™¤å…¨éƒ¨æ•°æ®") {
            sendDeleteAllRecordsRequest();
        } else {
            document.getElementById('deleteMessage').innerHTML = '<div class="message error">æ“ä½œå·²å–æ¶ˆæˆ–è¾“å…¥é”™è¯¯</div>';
        }
    }

    // --- æ–°å¢å‡½æ•°ï¼šå‘é€åˆ é™¤æ‰€æœ‰è®°å½•è¯·æ±‚ ---
    async function sendDeleteAllRecordsRequest() {
        const messageDiv = document.getElementById('deleteMessage');
        try {
            const response = await fetch('http://47.122.79.126:5233/api/delete_all_records', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ confirmation: "æˆ‘çŸ¥é“æˆ‘åœ¨å¹²ä»€ä¹ˆæˆ‘æ­£åœ¨åˆ é™¤å…¨éƒ¨æ•°æ®" }) // ç¡®ä¿å‘é€æ­£ç¡®çš„ç¡®è®¤å­—ç¬¦ä¸²
            });

            const data = await response.json();
            if (response.ok) {
                messageDiv.innerHTML = `<div class="message success">${data.message}</div>`;
                // åˆ é™¤åï¼Œåˆ·æ–°ç»Ÿè®¡ä¿¡æ¯ï¼Œå®ƒä»¬åº”è¯¥éƒ½å˜ä¸º0
                loadStats();
                loadDetailedStats();
            } else {
                messageDiv.innerHTML = `<div class="message error">${data.error}</div>`;
            }
        } catch (err) {
            console.error('Delete all records error:', err);
            messageDiv.innerHTML = '<div class="message error">ç½‘ç»œé”™è¯¯ï¼Œåˆ é™¤å¤±è´¥</div>';
        }
    }


    // é¡µé¢åŠ è½½æ—¶è·å–ç»Ÿè®¡ä¿¡æ¯
    window.onload = () => {
        loadStats();
        loadDetailedStats(); // åŠ è½½è¯¦ç»†ç»Ÿè®¡
    };

  </script>

  
</body>
</html>
